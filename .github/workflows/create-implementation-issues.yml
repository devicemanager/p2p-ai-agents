name: ğŸ“‹ Create GitHub Issues from Implementation Checklists

on:
  workflow_dispatch:
    inputs:
      component_filter:
        description: 'Filter by component (leave empty for all)'
        required: false
        type: string
      dry_run:
        description: 'Dry run (show what would be created without creating)'
        required: false
        default: true
        type: boolean

jobs:
  create-issues:
    name: ğŸ“‹ Generate Issues from Checklists
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
      
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: ğŸ“‹ Run Issue Creation Script
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        chmod +x scripts/create_implementation_issues.py
        
        if [[ "${{ inputs.dry_run }}" == "true" ]]; then
          echo "ğŸ” Running in dry-run mode..."
          python3 scripts/create_implementation_issues.py --dry-run
        else
          echo "ğŸš€ Creating GitHub issues..."
          python3 scripts/create_implementation_issues.py
        fi
        
    - name: ğŸ“¤ Upload Issues Data
      uses: actions/upload-artifact@v4
      with:
        name: implementation-issues-data
        path: implementation_issues.json
        retention-days: 30
        
    - name: ï¿½ Summary
      run: |
        if [[ "${{ inputs.dry_run }}" == "true" ]]; then
          echo "ğŸ” DRY RUN COMPLETED"
          echo ""
          echo "This run analyzed the implementation checklists."
          echo "ğŸ“¥ Download the 'implementation-issues-data' artifact to review what would be created."
          echo ""
          echo "To actually create the issues:"
          echo "1. Run this workflow again"
          echo "2. Uncheck 'Dry run'"
          echo "3. Click 'Run workflow'"
        else
          echo "ğŸ‰ ISSUE CREATION COMPLETED"
          echo ""
          echo "Check the workflow logs above for creation results."
          echo "View created issues: gh issue list --label implementation"
        fi

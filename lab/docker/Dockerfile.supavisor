FROM supabase/supavisor:2.6.1

# Copy entrypoint script
COPY supavisor-entrypoint.sh /usr/local/bin/supavisor-entrypoint.sh
RUN chmod +x /usr/local/bin/supavisor-entrypoint.sh

# Override entrypoint
ENTRYPOINT ["/usr/local/bin/supavisor-entrypoint.sh"]

# Default command (same as upstream)
CMD ["/bin/sh", "-c", "/app/bin/migrate && /app/bin/supavisor eval \"$$(cat /etc/pooler/pooler.exs)\" && /app/bin/server"]
